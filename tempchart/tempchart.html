<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>House Temperatures</title>
    <script language="javascript" type="text/javascript" src="flot/jquery.js"></script>  
    <script language="javascript" type="text/javascript" src="flot/jquery.flot.js"></script>
    <script language="javascript" type="text/javascript" src="flot/ostynscormtime.js"></script>
  </head>
  <body>
    <h1>House Temperatures / flot</h1>

    <div id="placeholder" style="width:1000px;height:500px;"></div>

    <div>
      <div><a href="tempchart">see this with flot</a></div>
      <div><a href="tempchart2">see this with timeplot</a></div>
    </div>


    <script id="source" language="javascript" type="text/javascript">
    
      $(document).ready(function(){
	  $.getJSON("temps", function(data) {
	      var plots = {};
	      $.each(data.sensors,
		     function(i, sens) {
			 plots[sens] = {
			     label:sens, 
			     data:[]
			 };
		     });
	      $.each(data.temps, function(i, reading) {
		  $.each(data.sensors, function(j, sens) {
		      var t = DateFromISOString(reading.time).getTime() / 1000;
		      if (reading[sens] != undefined) {
			  plots[sens].data.push([t, reading[sens]]);
		      }
		  });
	      });
	      var plotValues = [];
	      for(var x in plots) {
		  plotValues.push(plots[x]);
	      }

	      function tickGenerator(axis) {
		  var dt = axis.max - axis.min;
		  var res = [];
		  if (dt < 3600) {
		      // ...
		      res.push([axis.min, "t1"]);
		  }
		  return res;
	      }
	      
	      function prettyTime(secs) {
		  var d = new Date(secs * 1000);
		  return MakeISOtimeStamp(d, true).replace("T","<br/>\n");
	      }

	      var options = {
		  xaxis : {
		      //ticks : tickGenerator,
		      tickFormatter : prettyTime,
		  },
		  yaxis : {
		      min : 32,
		      max : 90,
		  },
	      };

	      $.plot($("#placeholder"), plotValues, options);

	  });
      });
    </script>


  </body>
</html>
 